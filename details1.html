<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout Details</title>
<style>
body { margin:0; background:#0e0e0e; color:#fff; font-family:Poppins, Arial;}
.navbar { width:100%; background:#111; padding:15px 25px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #222; position:sticky; top:0;}
.navbar a { color:#0ff; text-decoration:none; margin-left:15px; padding:8px 12px; border:1px solid #0ff; border-radius:6px; }
.navbar a:hover { background:#0ff; color:#000; }
.container { width:90%; max-width:650px; margin:40px auto; padding:25px; border-radius:12px; border:1px solid #222; box-shadow:0 0 10px rgba(0,255,255,0.2); background:#111;}
.product-preview { display:flex; gap:15px; align-items:center; margin-bottom:25px; padding:12px; border:1px solid #0ff; border-radius:10px; }
.product-preview img { width:70px; height:70px; border-radius:6px; object-fit:cover; border:1px solid #333; }
.product-preview div { font-size:14px; color:#0ff; }
h2 { text-align:center; color:#0ff; margin-bottom:25px; font-size:26px; }
label { font-size:14px; color:#0ff; display:block; margin-bottom:5px; }
input, textarea, select { width:100%; padding:10px; border-radius:6px; border:1px solid #333; background:#000; color:#fff; margin-bottom:20px; font-size:14px; }
textarea { height:100px; resize:none; }
.submit-btn { width:100%; padding:12px; background:#0ff; color:#000; border:none; border-radius:8px; font-size:16px; font-weight:600; cursor:pointer; transition:0.25s; }
.submit-btn:hover { background:#00e6e6; }
</style>
</head>
<body>

<div class="navbar">
  <div><a href="index.html">Home</a></div>
  <div><a href="cart.html">Cart</a> <a href="orders.html">Orders</a></div>
</div>

<div class="container">
  <div id="productBox" class="product-preview" style="display:none;">
    <img id="pImg" src="">
    <div>
      <div id="pName"></div>
      <div id="pPrice"></div>
    </div>
  </div>

  <h2>Delivery Details</h2>

  <form id="orderForm">
    <label>Full Name</label>
    <input type="text" id="name" required placeholder="Full Name">
    <label>Phone</label>
    <input type="tel" id="phone" pattern="[0-9]{10}" required placeholder="Phone">
    <label>Address</label>
    <textarea id="address" required placeholder="Full Address"></textarea>
    <label>Payment</label>
    <select id="payment" required>
      <option value="Prepaid (Online Payment)">Prepaid</option>
      <option value="Cash on Delivery">COD</option>
    </select>
    <label>Notes</label>
    <textarea id="notes" placeholder="Notes"></textarea>
    <button type="submit" class="submit-btn">Place Order</button>
  </form>
</div>

<script>
// Get product data
const productName = localStorage.getItem("productName") || "Unknown";
const productPrice = localStorage.getItem("productPrice") || "";
const productImage = localStorage.getItem("productImage") || "";

// Show product preview if available
if(productName && productImage){
  document.getElementById("productBox").style.display="flex";
  document.getElementById("pImg").src = productImage;
  document.getElementById("pName").textContent = productName;
  document.getElementById("pPrice").textContent = "₹" + productPrice;
}

// Form submission
document.getElementById('orderForm').addEventListener('submit', function(e){
  e.preventDefault();

  const data = {
    name: document.getElementById('name').value,
    phone: document.getElementById('phone').value,
    address: document.getElementById('address').value,
    payment: document.getElementById('payment').value,
    notes: document.getElementById('notes').value,
    productName, productPrice, productImage
  };

  fetch("https://script.google.com/macros/s/AKfycbzbprpkSO3rLRwTnbVp3KfUQCJpra2FFo0zJaaVCm-B9B8oKSgHioFsGBsB6x1nc9D-XA/exec", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(data)
  })
  .then(res => res.json())  // parse as JSON
  .then(res => {
    if(res.status === "success"){
      if(data.payment === "Cash on Delivery"){
        alert("✅ Order placed! (COD)");
        window.location.href="thankyou.html";
      } else {
        alert("✅ Order submitted! Redirecting to payment...");
        window.location.href="https://rzp.io/rzp/6S1rNG5";
      }
      this.reset();
      localStorage.removeItem("productName");
      localStorage.removeItem("productPrice");
      localStorage.removeItem("productImage");
    } else {
      alert("❌ Error: " + res.message);
    }
  })
  .catch(err => {
    console.error("Fetch error:", err);
    alert("❌ Something went wrong. Check console.");
  });
});
</script>

</body>
</html>
